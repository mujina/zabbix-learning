<!DOCTYPE html>
<!-- saved from url=(0046)http://brain.local/wiki/index.php/Pugme:Docker -->
<html lang="en-GB" dir="ltr" class="client-js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Pugme:Docker - brain</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Pugme:Docker","wgTitle":"Pugme:Docker","wgCurRevisionId":6582,"wgRevisionId":6582,"wgArticleId":764,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en-gb","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Pugme:Docker","wgRelevantArticleId":764,"wgRequestId":"WOYUHX9-ICASrq5hqHf2EgAAAAM","wgIsProbablyEditable":true,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.implement("user.options",function($,jQuery,require,module){mw.user.options.set({"variant":"en-gb"});});mw.loader.implement("user.tokens",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup","skins.vector.js"]);});</script>
<link rel="stylesheet" href="./Pugme_Docker - brain_files/load.php">
<style>
.mw-collapsible-toggle{float:right;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}  .mw-content-ltr .mw-collapsible-toggle,.mw-content-rtl .mw-content-ltr .mw-collapsible-toggle{float:right} .mw-content-rtl .mw-collapsible-toggle,.mw-content-ltr .mw-content-rtl .mw-collapsible-toggle{float:left}.mw-customtoggle,.mw-collapsible-toggle{cursor:pointer} caption .mw-collapsible-toggle,.mw-content-ltr caption .mw-collapsible-toggle,.mw-content-rtl caption .mw-collapsible-toggle,.mw-content-rtl .mw-content-ltr caption .mw-collapsible-toggle,.mw-content-ltr .mw-content-rtl caption .mw-collapsible-toggle{float:none} li .mw-collapsible-toggle,.mw-content-ltr li .mw-collapsible-toggle,.mw-content-rtl li .mw-collapsible-toggle,.mw-content-rtl .mw-content-ltr li .mw-collapsible-toggle,.mw-content-ltr .mw-content-rtl li .mw-collapsible-toggle{float:none} .mw-collapsible-toggle-li{list-style:none}
.suggestions{overflow:hidden;position:absolute;top:0;left:0;width:0;border:none;z-index:1099;padding:0;margin:-1px 0 0 0}.suggestions-special{position:relative;background-color:white;cursor:pointer;border:solid 1px #aaaaaa;padding:0;margin:0;margin-top:-2px;display:none;padding:0.25em 0.25em;line-height:1.25em}.suggestions-results{background-color:white;cursor:pointer;border:solid 1px #aaaaaa;padding:0;margin:0}.suggestions-result{color:black;margin:0;line-height:1.5em;padding:0.01em 0.25em;text-align:left; overflow:hidden;-o-text-overflow:ellipsis; text-overflow:ellipsis;white-space:nowrap}.suggestions-result-current{background-color:#4C59A6;color:white}.suggestions-special .special-label{color:gray;text-align:left}.suggestions-special .special-query{color:black;font-style:italic;text-align:left}.suggestions-special .special-hover{background-color:silver}.suggestions-result-current .special-label,.suggestions-result-current .special-query{color:white}.highlight{font-weight:bold}
@media screen {
	.tochidden,.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.toctoggle{font-size:94%}}
@media print {
	#toc.tochidden,.toctoggle{display:none}}
.postedit-container{margin:0 auto;position:fixed;top:0;height:0;left:50%;z-index:1000;font-size:13px}.postedit-container:hover{cursor:pointer}.postedit{position:relative;top:0.6em;left:-50%;padding:.6em 3.6em .6em 1.1em;line-height:1.5625em;color:#626465;background-color:#f4f4f4;border:1px solid #dcd9d9;text-shadow:0 0.0625em 0 rgba(255,255,255,0.5);border-radius:5px;box-shadow:0 2px 5px 0 #ccc;-webkit-transition:all 0.25s ease-in-out;-moz-transition:all 0.25s ease-in-out;-ms-transition:all 0.25s ease-in-out;-o-transition:all 0.25s ease-in-out;transition:all 0.25s ease-in-out}.skin-monobook .postedit{top:6em !important}.postedit-faded{opacity:0}.postedit-icon{padding-left:41px;  line-height:25px;background-repeat:no-repeat;background-position:8px 50%}.postedit-icon-checkmark{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB9ElEQVR4AZWRA3AYURQArxrVHtW2bdu2bdu2zdi2bdu2bWxs7zeehZaw4f70kbs+zI3e/nWK+RWx3aOFlrL56Sy5SxrruG69hlv6OyK+mz+8KDSXdXembj0ispT7tjs4ZTIbpYBvxGSGKzZTeFrb7W/meN002swFs0U8ttpHTkF2BvCqWQrW35929bTsKm5Zb+SEwWwcY8wAngB9m7Z+d+rIPZ/npdy12M5p47n8dXsCYAf0qPy06eGMdktuDu9Qf+JmKl3SWM91qzVcN9tAbEYkwMaq0tyb1m/To5kP170el/BK8/qa6sJr70ydf+T/Uu5ab+Oo/lS0AkUBpIFWlZ9WPhxpse/PHO7YbOOczjL0vZV2lNxPPtG73dYXM+xvm2znrOl83tidoqCwMBgYXsPFB0on5S6pr+eK5TKuW67lgvaKvF8mL1dtfTL32FHxRdyx3cQpg7m4x9sCXKkTIzA4LDH44zWdzaUf71hv5rTG4uyzcusybxSX7aThbMQ8XgCYAp3rzTTQOiIh9PNlzY3FSuZxrzjme1Y7uGS6kjsWO4jPjM4FVjRZsvD4kO9XtTZzQn82NyzWc0B7AmZh6gA/hOYSGhfw9YbOVnarj+S7800AL2BIsxUAbWNToj7bhBuQmZcOsFdoKUC74rGheCwXmqAIQTc9jQcrADIAAAAASUVORK5CYII=);background-image:url(/wiki/resources/src/mediawiki.action/images/green-checkmark.png?d94f1)!ie;background-position:left}.postedit-close{position:absolute;padding:0 .8em;right:0;top:0;font-size:1.25em;font-weight:bold;line-height:2.3em;color:black;text-shadow:0 0.0625em 0 white;text-decoration:none;opacity:0.2;filter:alpha(opacity=20)}.postedit-close:hover{color:black;text-decoration:none;opacity:0.4;filter:alpha(opacity=40)}</style><style>
.suggestions a.mw-searchSuggest-link,.suggestions a.mw-searchSuggest-link:hover,.suggestions a.mw-searchSuggest-link:active,.suggestions a.mw-searchSuggest-link:focus{color:black;text-decoration:none}.suggestions-result-current a.mw-searchSuggest-link,.suggestions-result-current a.mw-searchSuggest-link:hover,.suggestions-result-current a.mw-searchSuggest-link:active,.suggestions-result-current a.mw-searchSuggest-link:focus{color:white}.suggestions a.mw-searchSuggest-link .special-query{ overflow:hidden;-o-text-overflow:ellipsis; text-overflow:ellipsis;white-space:nowrap}</style><meta name="ResourceLoaderDynamicStyles" content="">
<script async="" src="./Pugme_Docker - brain_files/load(1).php"></script>
<meta name="generator" content="MediaWiki 1.27.1">
<link rel="alternate" type="application/x-wiki" title="Edit" href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit">
<link rel="edit" title="Edit" href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit">
<link rel="shortcut icon" href="http://brain.local/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="http://brain.local/wiki/opensearch_desc.php" title="brain (en-gb)">
<link rel="EditURI" type="application/rsd+xml" href="http://brain.local/wiki/api.php?action=rsd">
<link rel="alternate" type="application/atom+xml" title="brain Atom feed" href="http://brain.local/wiki/index.php?title=Special:RecentChanges&amp;feed=atom">
<script src="./Pugme_Docker - brain_files/load(2).php"></script></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Pugme_Docker rootpage-Pugme_Docker skin-vector action-view">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<div class="mw-indicators">
</div>
			<h1 id="firstHeading" class="firstHeading" lang="en-GB">Pugme:Docker</h1>
									<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From brain</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="http://brain.local/wiki/index.php/Pugme:Docker#mw-head">navigation</a>, 					<a href="http://brain.local/wiki/index.php/Pugme:Docker#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en-GB" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2><span class="toctoggle">&nbsp;[<a href="http://brain.local/wiki/index.php/Pugme:Docker#" id="togglelink">hide</a>]&nbsp;</span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Docker"><span class="tocnumber">1</span> <span class="toctext">Docker</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Installation"><span class="tocnumber">1.1</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Docker_Images"><span class="tocnumber">1.2</span> <span class="toctext">Docker Images</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Docker_Logs"><span class="tocnumber">1.3</span> <span class="toctext">Docker Logs</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Docker_Build"><span class="tocnumber">1.4</span> <span class="toctext">Docker Build</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Docker_Run"><span class="tocnumber">1.5</span> <span class="toctext">Docker Run</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Start_at_boot"><span class="tocnumber">1.6</span> <span class="toctext">Start at boot</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Monitoring_Options"><span class="tocnumber">1.7</span> <span class="toctext">Monitoring Options</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Network"><span class="tocnumber">1.8</span> <span class="toctext">Network</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Volumes"><span class="tocnumber">1.9</span> <span class="toctext">Volumes</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Dockerfiles"><span class="tocnumber">1.10</span> <span class="toctext">Dockerfiles</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Storage_Drivers"><span class="tocnumber">1.11</span> <span class="toctext">Storage Drivers</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Docker_Hub"><span class="tocnumber">1.12</span> <span class="toctext">Docker Hub</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Log"><span class="tocnumber">1.13</span> <span class="toctext">Log</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="http://brain.local/wiki/index.php/Pugme:Docker#Links"><span class="tocnumber">1.14</span> <span class="toctext">Links</span></a></li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Docker">Docker</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=1" title="Edit section: Docker">edit</a><span class="mw-editsection-bracket">]</span></span></h1>
<h2><span class="mw-headline" id="Installation">Installation</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=2" title="Edit section: Installation">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Base on my test repository to debug TLS connections in Rsyslog
</p><p>Channels 
</p>
<ul><li>Stable (<a rel="nofollow" class="external free" href="https://get.docker.com/">https://get.docker.com/</a>)</li>
<li>Experimental (<a rel="nofollow" class="external free" href="https://experimental.docker.com/">https://experimental.docker.com/</a>)</li>
<li>Test (<a rel="nofollow" class="external free" href="https://test.docker.com/">https://test.docker.com/</a>)</li></ul>
<p>Install stable 
</p>
<pre>curl get.docker.com 
usermod -aG docker user
</pre>
<p><br>
List containers 
</p>
<pre> docker ps -a # All
 docker ps -l # Last
</pre>
<p>Common flags
</p>
<pre> -i interactive 
 -t pseudo-tty
 -d daemonise
</pre>
<p>Remove containers (all, elegant)
</p>
<pre>docker rm `docker ps --no-trunc -aq`
</pre>
<h2><span class="mw-headline" id="Docker_Images">Docker Images</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=3" title="Edit section: Docker Images">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Remove docker images
</p>
<pre> docker rmi &lt;image-name&gt;
</pre>
<p>List images 
</p>
<pre> docker images
</pre>
<p>Removing dangling images 
</p>
<pre> docker rmi $(docker images -f dangling=true -q)
</pre>
<p>Use labels in Dockerfiles so you can target dangling images 
</p>
<pre> docker rmi $(docker images -f dangling=true -f label=application=$(REPO_NAME) -q)

</pre>
<p>Use the following in automation scripts to avoid errors on output 
</p>
<pre>docker images -q -f dangling=true -f label=application=$(REPO_NAME) | xargs -I ARGS docker rmi -f ARGS
</pre>
<h2><span class="mw-headline" id="Docker_Logs">Docker Logs</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=4" title="Edit section: Docker Logs">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Tail stdout 
</p>
<pre> docker logs &lt;container-id&gt; -f 
</pre>
<p><br>
Attach to exiting container 
</p>
<pre> docker start -a -i &lt;container-id&gt;
 docker attach  # For containers with /bin/bash, use Ctrl-p Ctrl-q to detach and leave running
 docker exec    # For containers without /bin/bash
</pre>
<p>Cleaning shutting down containers
</p><p>The stop command sends a SIGTERM to pid 1 and then 10 seconds later sends a SIGKILL if it hasn't exited.
</p>
<pre> docker stop &lt;container-id&gt; 
</pre>
<h2><span class="mw-headline" id="Docker_Build">Docker Build</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=5" title="Edit section: Docker Build">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Build a docker image 
</p>
<pre> docker build -t pugme/rsyslog-client:latest .
 docker build -t name -f path/to/dockerfile . # If Dockerfile is not in $CWD
</pre>
<h2><span class="mw-headline" id="Docker_Run">Docker Run</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=6" title="Edit section: Docker Run">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Run an image (Ports are host:container)
</p>
<pre> docker run -it -p 10514:10514/udp --name rsyslog-client pugme/rsyslog-client:latest /bin/bash
 docker run -it -p 10515:10514/udp --name rsyslog-logaggr pugme/rsyslog-logaggr:latest /bin/bash
 docker rm --rm ... remove the container after it exits automatically
</pre>
<ol><li> Long example to replicate a docker-compose entry for debugging ...</li></ol>
<pre> docker run -e "DJANGO_SETTINGS_MODULE=todobackend.settings.test" -e "MYSQL_HOST=db" -e "MYSQL_USER=root" -e "MYSQL_PASSWORD=password" -e "TEST_OUTPUT_DIR=/reports" \
 --volumes-from cache --link db --name test --entrypoint=/bin/bash dev_test
</pre>
<p><br>
Use -e to set environment variables for docker instances
</p>
<h2><span class="mw-headline" id="Start_at_boot">Start at boot</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=7" title="Edit section: Start at boot">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Use systemd to start Docker instances on boot 
</p><p>Example service file 
</p>
<pre> [Unit]
 Description=Redis container
 Requires=docker.service
 After=docker.service
 
 [Service]
 Restart=alwaysNote: This is just a brief introduction to creating images. We’ve skipped a whol
 ExecStart=/usr/bin/docker start -a redis_server
 ExecStop=/usr/bin/docker stop -t 2 redis_server
 
 [Install]
 WantedBy=default.target
</pre>
<h2><span class="mw-headline" id="Monitoring_Options">Monitoring Options</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=8" title="Edit section: Monitoring Options">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>List local host stats
</p>
<pre> docker stats
</pre>
<pre> <a rel="nofollow" class="external text" href="https://hub.docker.com/r/google/cadvisor">Google CAdvisor</a>
</pre>
<p>Runs as a container, for monitoring containers on a single host. Only does system resources.
</p>
<h2><span class="mw-headline" id="Network">Network</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=9" title="Edit section: Network">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Bridge + Overlay drivers
</p><p>Create a new network using bridge driver (-d) 
</p>
<pre> docker network create -d bridge my-bridge-network
</pre>
<p>Connect container to new bridge. This can be done while the container is running. You can connect containers to as many networks as you like. 
</p>
<pre> docker network connect my-bridge-network web
</pre>
<p>The docker_gwbridge is created automatically if you join a swarm network. This can be created ahead of time for custom configuration.
</p>
<h2><span class="mw-headline" id="Volumes">Volumes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=10" title="Edit section: Volumes">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Use the -v flag to add a volume at start. If using relative paths and data exists in the folder it is copied to the volume. 
For absolute paths, the volume is mounted over the top of existing folder (using bind mounts).
</p><p>Use the "docker inspect" command to fine the volume 
</p><p>Examples 
</p>
<pre> -v web # Non named volume, so uses UUID on host under default docker storage location
 -v web:web # Named volume, so uses name in path under default docker storage location  
 -v /web:web # Host volume (due to absolute path). 
</pre>
<p>You cannot add host volumes to Dockfiles as by their very nature they're not portable. 
</p><p>When you use named volumes you can share them using --volumes-from flag (akin to --link) 
</p><p>You can mount a single file i.e ~/.bash_history. This is a good example because the containers history is then saved to your local bash history.
</p><p>Volume containers example
</p>
<pre> sudo docker run -v /tmp/cache:/cache \
 --entrypoint true \ # Entrypoint set to true to make volume container exit immediately
 --name cache \ 
 todobackend-dev # Using an image for volume container that has required users etc.
</pre>
<p>Removing dangling volumes 
</p>
<pre> docker volume ls
</pre>
<h2><span class="mw-headline" id="Dockerfiles">Dockerfiles</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=11" title="Edit section: Dockerfiles">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Good example of entrypoints
</p>
<pre> ADD scripts/entrypoint.sh /usr/local/bin/entrypoint.sh
 RUN chmod +x /usr/local/bin/entrypoint.sh  
 ENTRYPOINT ["entrypoint.sh"]
</pre>
<p>Script entrypoint.sh uses exec to replace itself, thus making the arguments to exec parent process with PID 1
</p>
<pre> #!/bin/bash
 . /appenv/bin/activate # Use '.' and not source 
 exec $@
</pre>
<p>If we run docker as docker run python manage.py runserver, all args are passed to exec. 
</p>
<h2><span class="mw-headline" id="Storage_Drivers">Storage Drivers</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=12" title="Edit section: Storage Drivers">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li> AUFS - Unlikely to be available on RHEL. Bad for heavy writes as copies entire file to writable (thin) layer.</li></ul>
<p>The devicemapper driver stores every image and container on its own virtual device. 
These devices are thin-provisioned copy-on-write snapshot devices. Device Mapper 
technology works at the block level rather than the file level. This means that devicemapper 
storage driver’s thin provisioning and copy-on-write operations work with blocks rather than entire files.
In practice, however, containers that perform lots of small block writes (&lt;64KB) can perform worse with devicemapper than with AUFS.
</p><p>In production use direct-lvm mode. In this case we setup two logical volumes, one for data, the other for metadata. 
These magically got turned into one thin pool using (This command requires more research)
</p>
<pre> lvconvert -y --zero n -c 512K --thinpool docker/thinpool --poolmetadata docker/thinpoolmeta
</pre>
<p>We then enable auto extension on the pool (seems logical) using a profile. 
</p>
<pre> cat /etc/lvm/profile/docker-thinpool.profile
</pre>
<pre> activation {
   thin_pool_autoextend_threshold=80
   thin_pool_autoextend_percent=20
 }
</pre>
<pre> lvchange --metadataprofile docker-thinpool docker/thinpool
</pre>
<p>Enabled LVM monitoring (what is this&nbsp;?) 
</p>
<pre> lvs -o+seg_monitor
</pre>
<p>Modified the docker daemon options to enable the direct-lvm backend 
</p>
<pre> OPTIONS='--log-driver=journald --storage-driver=devicemapper --storage-opt=dm.thinpooldev=/dev/mapper/dockerlvm-thinpool \
 --storage-opt=dm.use_deferred_removal=true --storage-opt=dm.use_deferred_deletion=true'
</pre>
<p><br>
</p>
<pre> sdb                                             8:16   1 235.6G  0 disk  
 └─sdb1                                          8:17   1 235.6G  0 part  
   ├─dockerlvm-thinpool_tmeta                  253:4    0     2G  0 lvm   
   │ └─dockerlvm-thinpool                      253:6    0    50G  0 lvm   
   │   └─docker-253:1-393490-7b1a12109b510cff9a5c0ec685aac5f10fdfda244f79c0553ffc9cd857cdb7b2
   │     253:7    0    10G  0 dm    /var/lib/docker/devicemapper/mnt/7b1a12109b51
   └─dockerlvm-thinpool_tdata                  253:5    0    50G  0 lvm   
     └─dockerlvm-thinpool                      253:6    0    50G  0 lvm   
       └─docker-253:1-393490-7b1a12109b510cff9a5c0ec685aac5f10fdfda244f79c0553ffc9cd857cdb7b2
         253:7    0    10G  0 dm    /var/lib/docker/devicemapper/mnt/7b1a12109b51
</pre>
<pre> [root@pugme mapper]# lvs -a
   LV               VG        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
   [lvol0_pmspare]  dockerlvm ewi-------   2.00g                                                    
   thinpool         dockerlvm twi-aot---  50.00g             0.93   0.01                            
   [thinpool_tdata] dockerlvm Twi-ao----  50.00g                                                    
   [thinpool_tmeta] dockerlvm ewi-ao----   2.00g                                                    
   home             fedora    -wi-ao---- 181.41g                                                    
   root             fedora    -wi-ao----  50.00g                                                    
   swap             fedora    -wi-ao----   5.87g
</pre>
<h2><span class="mw-headline" id="Docker_Hub">Docker Hub</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=13" title="Edit section: Docker Hub">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>Log into hub 
</p>
<pre> docker login
</pre>
<p>You need to sign up for Private repositories. 
</p><p>You can link your Docker Hub account to BitBucket/GitHub so that you can build images automatically in Docker hub when you commit.
</p>
<h2><span class="mw-headline" id="Log">Log</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=14" title="Edit section: Log">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<p>You can pass stdout from containers to various logging systems using --log-driver command to docker.
</p>
<h2><span class="mw-headline" id="Links">Links</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit&amp;section=15" title="Edit section: Links">edit</a><span class="mw-editsection-bracket">]</span></span></h2>
<ul><li> <a rel="nofollow" class="external free" href="https://imagelayers.io/">https://imagelayers.io/</a> - Analysing image layers </li>
<li> <a rel="nofollow" class="external free" href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/">https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/</a> - Dockerfile best practice</li>
<li> <a rel="nofollow" class="external free" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a> - Dockerfile reference</li></ul>

<!-- 
NewPP limit report
Cached time: 20170406101037
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.020 seconds
Real time usage: 0.020 seconds
Preprocessor visited node count: 58/1000000
Preprocessor generated node count: 64/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key my_wiki:pcache:idhash:764-0!*!*!!en-gb!*!* and timestamp 20170406101037 and revision id 6582
 -->
</div>					<div class="printfooter">
						Retrieved from ‘<a dir="ltr" href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;oldid=6582">http://brain.local/wiki/index.php?title=Pugme:Docker&amp;oldid=6582</a>’					</div>
				<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-anonuserpage">Not logged in</li><li id="pt-anontalk"><a href="http://brain.local/wiki/index.php/Special:MyTalk" title="Discussion about edits from this IP address [alt-shift-n]" accesskey="n">Talk</a></li><li id="pt-anoncontribs"><a href="http://brain.local/wiki/index.php/Special:MyContributions" title="A list of edits made from this IP address [alt-shift-y]" accesskey="y">Contributions</a></li><li id="pt-createaccount"><a href="http://brain.local/wiki/index.php?title=Special:CreateAccount&amp;returnto=Pugme%3ADocker" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="http://brain.local/wiki/index.php?title=Special:UserLogin&amp;returnto=Pugme%3ADocker" title="You are encouraged to log in; however, it is not mandatory [alt-shift-o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li id="ca-nstab-main" class="selected"><span><a href="http://brain.local/wiki/index.php/Pugme:Docker" title="View the content page [alt-shift-c]" accesskey="c">Page</a></span></li>
															<li id="ca-talk" class="new"><span><a href="http://brain.local/wiki/index.php?title=Talk:Pugme:Docker&amp;action=edit&amp;redlink=1" title="Discussion about the content page [alt-shift-t]" accesskey="t" rel="discussion">Discussion</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label" tabindex="0">
							<span>Variants</span><a href="http://brain.local/wiki/index.php/Pugme:Docker#" tabindex="-1"></a>
						</h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="http://brain.local/wiki/index.php/Pugme:Docker">Read</a></span></li>
															<li id="ca-edit"><span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=edit" title="Edit this page [alt-shift-e]" accesskey="e">Edit</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=history" title="Past revisions of this page [alt-shift-h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label" tabindex="0"><span>More</span><a href="http://brain.local/wiki/index.php/Pugme:Docker#" tabindex="-1"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="http://brain.local/wiki/index.php" id="searchform">
							<div id="simpleSearch">
							<input type="search" name="search" placeholder="Search" title="Search brain [alt-shift-f]" accesskey="f" id="searchInput" tabindex="1" autocomplete="off"><input type="hidden" value="Special:Search" name="title"><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton">							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="http://brain.local/wiki/index.php/Main_Page" title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id="p-navigation" aria-labelledby="p-navigation-label">
			<h3 id="p-navigation-label">Navigation</h3>

			<div class="body">
									<ul>
						<li id="n-mainpage-description"><a href="http://brain.local/wiki/index.php/Main_Page" title="Visit the main page [alt-shift-z]" accesskey="z">Main page</a></li><li id="n-recentchanges"><a href="http://brain.local/wiki/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [alt-shift-r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="http://brain.local/wiki/index.php/Special:Random" title="Load a random page [alt-shift-x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>					</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
			<h3 id="p-tb-label">Tools</h3>

			<div class="body">
									<ul>
						<li id="t-whatlinkshere"><a href="http://brain.local/wiki/index.php/Special:WhatLinksHere/Pugme:Docker" title="A list of all wiki pages that link here [alt-shift-j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="http://brain.local/wiki/index.php/Special:RecentChangesLinked/Pugme:Docker" title="Recent changes in pages linked from this page [alt-shift-k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="http://brain.local/wiki/index.php/Special:SpecialPages" title="A list of all special pages [alt-shift-q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;printable=yes" rel="alternate" title="Printable version of this page [alt-shift-p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;oldid=6582" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="http://brain.local/wiki/index.php?title=Pugme:Docker&amp;action=info" title="More information about this page">Page information</a></li>					</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 23 February 2017, at 13:46.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="http://brain.local/wiki/index.php/brain:Privacy_policy" title="brain:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="http://brain.local/wiki/index.php/brain:About" title="brain:About">About brain</a></li>
											<li id="footer-places-disclaimer"><a href="http://brain.local/wiki/index.php/brain:General_disclaimer" title="brain:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-poweredbyico">
							<a href="http://www.mediawiki.org/"><img src="./Pugme_Docker - brain_files/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/wiki/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /wiki/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"></a>						</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"]);});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":248});});</script>
	

<div class="suggestions" style="display: none; font-size: 13px;"><div class="suggestions-results"></div><div class="suggestions-special"></div></div></body></html>